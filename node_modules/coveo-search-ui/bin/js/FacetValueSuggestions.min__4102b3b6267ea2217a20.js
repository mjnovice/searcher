webpackJsonpCoveo__temporary([47],{243:function(t,e,n){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function u(t){try{l(o.next(t))}catch(t){i(t)}}function s(t){try{l(o.throw(t))}catch(t){i(t)}}function l(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(u,s)}l((o=o.apply(t,e||[])).next())})},u=this&&this.__generator||function(t,e){function n(t){return function(e){return o([t,e])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,i&&(u=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(u=u.call(i,n[1])).done)return u;switch(i=0,u&&(n=[0,u.value]),n[0]){case 0:case 1:u=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,i=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(u=l.trys,!(u=u.length>0&&u[u.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3])){l.label=n[1];break}if(6===n[0]&&l.label<u[1]){l.label=u[1],u=n;break}if(u&&l.label<u[2]){l.label=u[2],l.ops.push(n);break}u[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(t){n=[6,t],i=0}finally{r=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,u,s,l={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0}),n(486);var s=n(0),l=n(33),a=n(3),c=n(70),p=n(194),f=n(1),g=n(121),h=n(10),d=n(7),y=n(8),m=n(2),b=n(579),v=function(t){function e(n,o,r){var i=t.call(this,n,e.ID,r)||this;return i.options=o,i.options=y.ComponentOptions.initComponentOptions(n,e,o),i.facetValueSuggestionsProvider=new b.FacetValueSuggestionsProvider(i.queryController,{field:i.options.field}),i.queryStateFieldFacetId="f:"+i.options.field,i.options.templateHelper||(i.options.templateHelper=e.defaultTemplate),f.$$(i.root).on(l.OmniboxEvents.populateOmniboxSuggestions,function(t,e){e.suggestions.push(i.getSuggestions(e.omnibox))}),i}return o(e,t),e.defaultTemplate=function(t,e){var n=t.keyword.html,o=g.DomUtils.highlight(t.value,"coveo-omnibox-hightlight"),r=this.options.displayEstimateNumberOfResults?g.DomUtils.highlight(" ("+c.l("ResultCount",t.numberOfResults.toString(),t.numberOfResults)+")","coveo-omnibox-suggestion-results-count",!0):"";return""+c.l("KeywordInCategory",n,o)+r},e.getQuerySuggestionKeywordFromText=function(t){return{text:t,html:g.DomUtils.highlight(t,"coveo-omnibox-hightlight")}},e.prototype.getSuggestions=function(t){return i(this,void 0,void 0,function(){var e,n;return u(this,function(o){switch(o.label){case 0:return 0==this.options.numberOfSuggestions?[2,[]]:(e=t.getText(),[4,this.getFacetValueSuggestions(e,t)]);case 1:return n=o.sent(),[2,n||[]]}})})},e.prototype.getQuerySuggestionsKeywords=function(t){return i(this,void 0,void 0,function(){var e;return u(this,function(n){switch(n.label){case 0:return this.options.useQuerySuggestions&&t.suggestionAddon?[4,t.suggestionAddon.getSuggestion()]:[3,2];case 1:return e=n.sent(),[2,e.map(function(t){var e=t.text,n=t.html;return{text:e||"",html:n}})];case 2:return[2,[]]}})})},e.prototype.getFacetValueSuggestions=function(t,n){return i(this,void 0,void 0,function(){var o,r,i;return u(this,function(u){switch(u.label){case 0:return o=this.options.useValueFromSearchbox?[e.getQuerySuggestionKeywordFromText(t)]:[],[4,this.getQuerySuggestionsKeywords(n)];case 1:return r=u.sent(),i=s.unique(o.concat(r).filter(function(t){return""!=t.text}),function(t){return t.text}),0===i.length?[2,[]]:[2,this.getSuggestionsForWords(i,n)]}})})},e.prototype.getSuggestionsForWords=function(t,e){return i(this,void 0,void 0,function(){var n,o,r,i,s=this;return u(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,this.facetValueSuggestionsProvider.getSuggestions(t)];case 1:return n=u.sent(),this.logger.debug("FacetValue Suggestions Results",n),o=this.queryStateModel.get(this.queryStateFieldFacetId)||[],r=n.filter(function(t){return s.isSuggestionRowAlreadyCheckedInFacet(t,o)}),[2,this.rankSuggestionRows(r).map(function(t){return s.mapFacetValueSuggestion(t,e)})];case 2:return i=u.sent(),this.logger.error(i),[2,[]];case 3:return[2]}})})},e.prototype.isSuggestionRowAlreadyCheckedInFacet=function(t,e){return!e.some(function(e){return e==t.value})},e.prototype.rankSuggestionRows=function(t){var e=t.sort(function(t,e){return e.score.distanceFromTotalForField-t.score.distanceFromTotalForField}).slice(),n=Math.ceil(this.options.numberOfSuggestions/2),o=-Math.floor(this.options.numberOfSuggestions/2),r=e.splice(0,n);if(0!=o){var i=e.slice(o);return r.concat(i)}return r},e.prototype.mapFacetValueSuggestion=function(t,e){var n=this;return{html:this.buildDisplayNameForRow(t,e),onSelect:function(){return n.onRowSelection(t,e)}}},e.prototype.buildDisplayNameForRow=function(t,n){try{return this.options.templateHelper.call(this,t,n)}catch(o){return this.logger.error("Could not apply template from options for the given row. Will use default template.",o,t,n),e.defaultTemplate.call(this,t,n)}},e.prototype.onRowSelection=function(t,e){e.setText(t.keyword.text);var n=r({},this.queryStateModel.get(p.QueryStateModel.attributesEnum.fv)),o=n[this.options.field.toString()]||[],i=this.options.isCategoryField?t.value.split(this.options.categoryFieldDelimitingCharacter):[t.value];n[this.options.field.toString()]=o.concat(i),this.queryStateModel.set(p.QueryStateModel.attributesEnum.fv,n),e.magicBox.blur(),this.usageAnalytics.logSearchEvent(h.analyticsActionCauseList.omniboxField,{}),this.queryController.executeQuery()},e.ID="FacetValueSuggestions",e.doExport=function(){a.exportGlobally({FacetValueSuggestions:e})},e.options={field:y.ComponentOptions.buildFieldOption({required:!0}),numberOfSuggestions:y.ComponentOptions.buildNumberOption({defaultValue:5,min:1}),useQuerySuggestions:y.ComponentOptions.buildBooleanOption({defaultValue:!0}),useValueFromSearchbox:y.ComponentOptions.buildBooleanOption({postProcessing:function(t,e){return t||!e.useQuerySuggestions}}),displayEstimateNumberOfResults:y.ComponentOptions.buildBooleanOption({defaultValue:!1}),templateHelper:y.ComponentOptions.buildCustomOption(function(){return null}),isCategoryField:y.ComponentOptions.buildBooleanOption({defaultValue:!1}),categoryFieldDelimitingCharacter:y.ComponentOptions.buildStringOption({defaultValue:"|",depend:"isCategoryField"})},e}(d.Component);e.FacetValueSuggestions=v,m.Initialization.registerAutoCreateComponent(v)},486:function(t,e){},579:function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function u(t){try{l(o.next(t))}catch(t){i(t)}}function s(t){try{l(o.throw(t))}catch(t){i(t)}}function l(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(u,s)}l((o=o.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){function n(t){return function(e){return o([t,e])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,i&&(u=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(u=u.call(i,n[1])).done)return u;switch(i=0,u&&(n=[0,u.value]),n[0]){case 0:case 1:u=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,i=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(u=l.trys,!(u=u.length>0&&u[u.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3])){l.label=n[1];break}if(6===n[0]&&l.label<u[1]){l.label=u[1],u=n;break}if(u&&l.label<u[2]){l.label=u[2],l.ops.push(n);break}u[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(t){n=[6,t],i=0}finally{r=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,u,s,l={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.queryController=t,this.options=e}return t.prototype.getSuggestions=function(t){return o(this,void 0,void 0,function(){var e;return r(this,function(n){switch(n.label){case 0:return[4,this.getFieldValuesToQuery(t)];case 1:return e=n.sent(),[2,this.getAllSuggestionsRows(e.responses,e.reference)]}})})},t.prototype.getAllSuggestionsRows=function(t,e){var n=this;return t.reduce(function(t,o){var r=o.values.map(function(t){return{numberOfResults:t.numberOfResults,keyword:o.keyword,value:t.value,score:n.computeScoreForSuggestionRow(t,e),field:n.options.field}});return t.concat(r)},[])},t.prototype.getFieldValuesToQuery=function(t){return o(this,void 0,void 0,function(){var e,n,o,i,u,s,l,a=this;return r(this,function(r){switch(r.label){case 0:return e=this.buildReferenceFieldValueRequest(),n=this.getQueryToExecuteParts(),o=t.map(function(t){return a.buildListFieldValueRequest(n.concat([t.text]).join(" "))}),i=o.concat([e]),[4,this.queryController.getEndpoint().listFieldValuesBatch({batch:i})];case 1:return u=r.sent(),s=this.computeReferenceFromBatch(u.pop()),l=u.map(function(e,n){return{keyword:t[n],values:e}}),[2,{responses:l,reference:s}]}})})},t.prototype.computeScoreForSuggestionRow=function(t,e){var n=e.fieldsTotal[t.value]||e.smallestTotal;return{distanceFromTotalForField:(n-t.numberOfResults)/n*100}},t.prototype.computeReferenceFromBatch=function(t){var e={};return t.forEach(function(t){return e[t.value]=t.numberOfResults}),{fieldsTotal:e,smallestTotal:t[t.length-1].numberOfResults}},t.prototype.buildListFieldValueRequest=function(t){return{field:this.options.field,ignoreAccents:!0,maximumNumberOfValues:3,queryOverride:t}},t.prototype.buildReferenceFieldValueRequest=function(){return{field:this.options.field}},t.prototype.getQueryToExecuteParts=function(){var t=this.queryController.getLastQuery();return[t&&t.aq?this.removeFieldExpressionFromExpression(this.options.field.toString(),t.aq):"",t.cq].filter(function(t){return!!t})},t.prototype.removeFieldExpressionFromExpression=function(t,e){return e.replace(new RegExp(t+"==([^)]*)","gi"),"").replace(new RegExp(t+"==[^ ]*","gi"),"")},t}();e.FacetValueSuggestionsProvider=i}});